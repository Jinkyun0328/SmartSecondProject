<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>python 개발일지</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="손톱-검출-프로그램-개발일지">손톱 검출 프로그램 개발일지</h1>
<h2 id="색상-검출과-도형-검출을-사용한-디텍팅">1. 색상 검출과 도형 검출을 사용한 디텍팅</h2>
<h3 id="손-사진-출력">1-1. 손 사진 출력</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/279619665-26d4c09d-0567-4626-81ca-4be2f97108e5.PNG" alt="image1"><br>
python의 opencv를 사용하여 손 사진에서 손톱을 검출하려고 한다.</p>
<h3 id="배경-삭제">1-2. 배경 삭제</h3>
<p>입력한 사진의 배경이 흰색으로 따로 처리하지 않았다.<br>
다른 배경이 존재한다면 배경을 제거하는 작업이 필요할 것으로 예상된다.</p>
<h3 id="색상검출">1-3. 색상검출</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/279619671-be9ee8dc-db63-42c8-87c5-64c8ff76abd2.PNG" alt="image2"><br>
색상검출을 사용하여 손을 검출하려고 했다.<br>
생각보다 잘 적용되지 않았고 손 색이라는 것이 사람마다 다르고 배경이나 조명에 따라 다르게 적용될 가능성이 높기 때문에 높은 정확도가 나오지 않을 것이라 예상된다.</p>
<p><img src="https://user-images.githubusercontent.com/123911778/279622041-6f22293d-af88-48ee-852d-5ba5032b4bb9.PNG" alt="image2_1"><br>
사진에서 손 부분을 정확히 검출한다고 해도 손과 손톱을 색상만으로 검출하는 것은 다소 어려움이 있다. 위의 사진은 손의 흑백사진에서 히스토그램 평준화를 사용하여 윤곽을 또렷하게 한 것이다. 손과 손톱의 색상은 큰 차이를 보이고 있지 않다.</p>
<h3 id="canny-적용">1-4. Canny 적용</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/279619675-80adccbb-8af0-4a95-9e0c-ab628d07a077.PNG" alt="image3"><br>
opencv에서 제공하는 adaptiveThreshold 함수를 사용하여 edge를 검출하려 출력했다.<br>
blk_size은 블럭 사이즈를 의미하고 C는 차감함수를 의미한다. C가 작을수록 촘촘하게 출력되고 C가 클수록 듬성듬성 출력되었다.</p>
<h3 id="원-검출">1-5. 원 검출</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/279622033-7d6ce464-f00c-42c5-ada9-36e6404e72d8.PNG" alt="image5"><br>
손톱은 원형에 가까운 모양이기 때문에 도형검출에서 원형검출을 사용하면 손과 손톱을 구분할 수 있지 않을까 가정하여 원형검출을 진행했다. 매개변수를 조절해가면서 진행한 결과 정확히 손톱 부분만 캐치한 경우가 없는 것으로 보아 도형검출을 사용하여 손과 손톱을 구분하는 것은 어려울 것이라 생각한다.</p>
<h2 id="mediapipe를-사용한-손-인식">2. Mediapipe를 사용한 손 인식</h2>
<p>Mediapipe은 사진에서 얼굴이나 손 등을 검출하는 프로그램이다.</p>
<h3 id="mediapipe를-사용하여-손-좌표-검출">2-1. Mediapipe를 사용하여 손 좌표 검출</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/279622042-656af673-af16-401c-928c-80c4d53e4a2d.PNG" alt="image2_1"><br>
앞의 손 사진에 mediapipe을 적용하면 위와 같인 손 끝과 관절, 손목의 위치를 검출하여 좌표를 찍어준다.</p>
<p><img src="https://user-images.githubusercontent.com/123911778/279622037-dfdfae05-3b0f-4cfb-bfb9-2d77fdad40ab.PNG" alt="image2_2">mediapipe에서 각각의 점의 index와 나타내는 값은 다음과 같다. 여기서 손톱을 검출하는데 필요한 것은 엄지(3, 4), 검지(7, 8), 중지(11, 12), 약지(15, 16), 소지(19, 20)이다.</p>
<h3 id="사진-회전">2-2) 사진 회전</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/279654374-aefca7c3-348a-4930-9a3c-c691e6180038.PNG" alt="image2_3"><br>
손톱 위에 네일아트를 착장하기 위해서는 네일아트 그림 또는 손가락 사진을 회전시켜야한다. 각 손가락마다 수직으로 회전시킨 다음에 부분적으로 사진을 자른 다음 네일아트를 칠하는 방식으로 진행해보려고 한다.</p>
<p>위의 사진은 엄지손가락으로 3, 4번이 위 아래로 1자가 되도록 이미지를 회전시킨 것이다.</p>
<p>대안) 손 사진을 회전시키는 것보다는 손의 위치와 손의 각도에 따라 네일아트 이미지를 변환시키는 것이 더 나을 것이라 판단. 일단은 손 사진을 기반으로 변환함수를 만들고 적용하기</p>
<p>엄지손가락의 손끝 좌표4를 고정시키고 좌표3을 수직인 아래로 올 수 있도록 회전변환<br>
<img src="https://user-images.githubusercontent.com/123911778/280563176-cfb836e2-59da-47bf-afed-a13c85a3b892.PNG" alt="image2_4"><br>
바깥 영역으로 넘어가버릴 위험성 존재<br>
네일아트를 크로마키한 다음 다이 원본으로 되돌리기 난해함</p>
<h3 id="좌표-회전">2-3) 좌표 회전</h3>
<p>2-2의 이미지는 이미지의 중간좌표를 중심으로 시계방향으로 회전시킨 것이다. 5개의 손가락에서 손끝을 위로가고 첫 번째 마디가 아래로 가도록 회전시켜보자.</p>
<p>회전변환행렬에 따라서<br>
rx = xcosa - ysina<br>
ry = xsina + ycosa<br>
가 된다.</p>
<p>(x, y)를 반시계 방향으로 a만큼 회전시켰을 때 (rx, ry)의 좌표는 위와 같이 구할 수 있다.</p>
<p>이번에는 (x, y)와 (rx, ry)가 주어졌을 때 a를 구하는 방법을 알아보자.<br>
a = arccos(xrx+yry / xx+yy)<br>
a = arcsin(xry-yrx / xx+yy)<br>
로 구할 수 있다.</p>
<p>** python 함수 코드**<br>
좌표 변환하기<br>
rad = degree * (math.pi / 180.0)<br>
rx = round(math.cos(rad)*x - math.sin(rad)*y)<br>
ry = round(math.sin(rad)*x + math.cos(rad)*y)</p>
<p>좌표 사이의 각도 구하기<br>
rad1 = math.acos(((x<em>rx)+(y</em>ry))/((x<em>x)+(y</em>y)))<br>
rad2 = math.asin(((x<em>ry)-(y</em>rx))/((x<em>x)+(y</em>y)))</p>
<p>deg1 = rad1 * (180.0 / math.pi)<br>
deg2 = rad2 * (180.0 / math.pi)</p>
<p>(1, 1)과 (2, 3) 사이의 각도 구하기<br>
(1, 1)을 기준으로 (2, 3)과 (1, 1) 사이의 각도를 구한다.<br>
기준이 되는 (1, 1)을 원점으로 이동시키고 (2, 3)을 그만큼 평행이동시킨다.<br>
그럼 원점과 (1, 2) 사이의 각도를 구하는 것이 된다.</p>
<p>rad = math.atan2()</p>
<h3 id="회전변환을-손-사진에-적용하고-각도-구하기">2-4) 회전변환을 손 사진에 적용하고 각도 구하기</h3>
<p><img src="https://user-images.githubusercontent.com/123911778/280565114-c93355da-ffb6-4a1c-afe0-c5dd33fcf61e.PNG" alt="image2_4_1"><br>
위의 사진은 엄지 손가락의 끝점(4)과 엄지 손가락의 첫 번째 마디(3) 사이의 각도를 구한 것으로 61.25도로 나온다.</p>
<p><img src="https://user-images.githubusercontent.com/123911778/280565119-9ffcfc8b-8966-4f88-9ead-763a150ba7d1.PNG" alt="image2_4_2"><br>
위의 사진은 새끼 손가락의 끝점(20)과 새끼 손가락의 첫 번째 마디(19) 사이의 각도를 구한 것으로 -23.51도로 나온다.</p>
</div>
</body>

</html>
